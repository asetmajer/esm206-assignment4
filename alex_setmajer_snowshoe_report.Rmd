---
title: "Exploratory Report: Juvenile Snowshoe Hares, 1998-2012"
author: "Alex Setmajer"
date: "11/8/2021"
output: 
  html_document: 
    theme: cosmo
---

```{r setup, echo= FALSE, include= FALSE, warning= FALSE, message= FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

library(tidyverse)
library(here)
library(lubridate)
library(effsize)
library(GGally)
library(modelsummary)
library(kableExtra)
library(broom)
```


## Introduction

This report explores the counts and sizes of juvenile snowshoe hares recorded at the Bonanza Creek Experimental Forest in Alaska from 1998 - 2012. It includes summaries on annual juvenile hare counts, juvenile hare weights, and explores the relationship between juvenile weight and hind foot length.

basic background information about the subject, site and study (with citations as needed)

## Data and Analysis

Bonanza Creek LTER is part of the US Long Term Ecological Research (LTER) Network. 

Data citation: Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14

ADD ___ provide an overview of the main analysis, statistical methods and tools used.

Per the Metadata provided by the LTER team:

-weight (g)
-hindfoot length (unit not provided)

And, there are three sampling sites:
- Site A (bonrip in original data set): Located in a flood zone along the Tanana River and Bonanza Mature is a mature black spruce forest approximately 1 km inland from the river and 2 km from the riparian plot. 
- Site B (bonmat in original data set): Consisted of stands of mature white spruce, paper birch and alder, as well as black spruce and other plants.
- Site C (bonbs in original data set): Located in a mature lowland black spruce stand.

```{r}
hares <- read_csv(here( "data","bonanza_hares.csv"))
```

## Juvenile Hare Initial Investigation
The following sections summarize data on Juvenile Snowshoe Hares based on the data provided from the LTER fieldwork. On average, data was collected quarterly each year.

An important data limitation to consider while reviewing the findings is that age data has only been provided for 1120 out of 3197 observations, or 35% of total observations. Additionally, age for observed hares did not begin being collected until June 1999, and there are significant gaps throughout the years of when age is reported. Of the observations with age data, there were only 378 juveniles counted (33.75% juveniles out of those with age data, or 11.82% of total observations).This means that this report focuses on a relatively small subset of the data collected.

### Part 1: Annual Juvenile Hare Trap Counts

```{r, fig.cap= "<b>Figure 1. Annual Juvenile Snowshoe Hare Trappings, 1998-2012.</b> This table provides a summary of the total juvenile Snowshoe Hares trapped annually between the years of 1998-2012." }

hares_yr <- hares %>%
  mutate(date_new = mdy(date)) %>% 
  mutate(year_new = year(date_new))

age_hares_yr <- hares_yr %>% 
  group_by(year_new) %>% 
  count(age) %>% 
  filter(age == "a" | age == "j")

total_age <- sum(age_hares_yr$n)

juv_hares_yr <- hares_yr %>% 
  group_by(year_new) %>% 
  count(age) %>% 
  filter(age == "j")

summary(juv_hares_yr)

total_juv <- sum(juv_hares_yr$n)

total_age/3197
total_juv/total_age
total_juv/3197

windowsFonts(A = windowsFont("Verdana")) 

ggplot(data=juv_hares_yr, aes(x=year_new, y=n, )) +
  geom_col(width=.5, fill= "#D9A042")+
  theme_minimal()+
  scale_x_continuous(breaks = seq(1998, 2012, 2)) +
  scale_y_continuous(breaks = seq(0,130,20))+
  labs(x= "Year", y= "Snowshoe Hare Count") +
  theme(axis.text.x = element_text(family = "A"), plot.title = element_text(family = "A"), axis.title = element_text(family = "A"))
 
```


The key takeaway from Figure 1 is that there appears to be an overall trend of decreasing juvenile hare counts. While some years counted more juveniles than others, as time went on, 'high-count' years were still significantly lower than juvenile counts in the first couple years of data collected. The minimum number of juveniles counted  was 2 hares, the maximum number of juveniles was 126 hares. The mean count was approximately 32 juvenile hares, and the median was approximately 19 juvenile hares.

In order to standardize the juvenile hare population in future analyses, age data should be a required variable to provide for all observations of trapped hares. Using this data set as is, future analyses could be standardized by first meeting with data set owners to confirm that declining age trend seen in graph aligns with actual field conditions observed (confirming there was no other factor that limited the accurate collection of hare age). Then, using a linear regression or other model to create a formula that predicts the overall trend in juvenile hare counts with time.

### Part 2: Juvenile Hare Weights

```{r, fig.cap= "<b> Figure 2. Hare weights by sex and site.</b> This graph visually compares juvenile hare weights by sex and site. Variables where sex is not recorded are included in the graph in the N/A column."}
juv_hares_w <- hares %>% 
  select(sex, weight, grid)

ggplot(data= juv_hares_w, aes(x=sex,y=weight), na.rm= FALSE)+
  geom_count(aes(color=sex), na.rm=FALSE)+
  facet_wrap(~grid)+
  theme_minimal()+
  theme(axis.text.x = element_text(family = "A"), plot.title = element_text(family = "A"), axis.title = element_text(family = "A")) +
  labs(x= "Sex", y= "Weight()")

## still need to refine this plot
```

Key takeaways from Figure 2 include the observation that the majority of juvenile hares across all ages range between approximately 750 and 1750 grams. The Bonrip site had the most juvenile hares recorded. Overall, there appears to be a wider spread of female juvenile weights than male juvenile weights, especially at the Bonbs site.

### Part 3: Juvenile Weight Comparison

Further compare mean weights for **juvenile male and female snowshoe hares** included in this study. 

A finalized table containing the mean, standard deviation, and sample size for male and female juvenile snowshoe hares.

*Table 1. Title.* Caption here

```{r}
juv_hares_w_m <- juv_hares_w %>% 
  filter(sex =="m") %>% 
  filter(weight %in% c(0:3000)) %>% 
  pull(weight)

juv_hares_w_f <- juv_hares_w %>% 
  filter(sex == "f") %>% 
  filter(weight %in% c(0:3000)) %>% 
  pull(weight)

juv_hares_w_mf_t <- t.test(juv_hares_w_m, juv_hares_w_f)
juv_hares_w_mf_t

juv_hares_w_mf_cohen <-cohen.d(juv_hares_w_m, juv_hares_w_f)
juv_hares_w_mf_cohen

##do QQ graph & create table
```


```{r, exploratory, include = true}
ggplot(data=juv_hares_w, aes(y=weight)) +
  geom_histogram(aes(fill=sex), na.rm=FALSE)+
  facet_wrap(~grid)+
  theme_minimal()

ggpairs(juv_hares_w)

juv_hares_w_mf_ci <- t.test(juv_hares_w_mf$weight)
juv_hares_w_mf_ci

juv_hares_w_mf_sd <- sd(juv_hares_w_mf$weight)
juv_hares_w_mf_sd

```
A 2 - 3 sentence comprehensive statement of the means comparison, including at least:
The actual difference in means
Effect size (Cohen's *d*) (see effsize::cohen.d() example in the Lab 5 key)
Outcome of an unpaired two-sample t-test
 
Note: Exploratory graphs (e.g. histograms, QQ-plots) to explore assumptions of your t-test should not show up in your final knitted document, but you DO still need to create and think about them to determine whether a t-test is appropriate. If you want keep the code chunk containing those exploratory visualizations in your .Rmd but not appear in the knitted doc, you can add `include = FALSE` in the code chunk header.

### Part 4: Relationship between Juvenile Weight & Hind Foot Length

Explore the relationship between juvenile snowshoe hare hind foot length (variable `hindft`, recorded in millimeters), and weight. Include all juvenile hares in the study. Create a final visualization of juvenile hare hind foot length versus weight. Include a figure caption.

```{r, fig.cap = "text"}
juv_hares_hft <- hares %>% 
  select(weight, hindft, grid)

ggplot(data=juv_hares_hft, aes(x=hindft, y=weight))+
  geom_point(aes(color=grid))

```

#### Linear Regression: Juvenile Hare Weight to Hind Foot Length
Upon seeing your graph, your “boss” tells you to try out linear regression to describe how juvenile snowshoe hare weight changes with respect to hind foot length. Try it out (the only variables you are expected to include here are hind foot length and weight, using data for all juvenile hares in the data, e.g. you are not expected to explore impacts of sex, site, etc.), and check the model diagnostics.

```{r}
juv_hares_hft_lm <- lm(weight ~ hindft, data = juv_hares_hft)

juv_hares_hft_lm

plot(juv_hares_hft_lm)
```


In 2 - 3 sentences below your figure, describe the outcome of your linear regression exploration (e.g. slope interpretation, R2 value, and Pearson's r correlation) and touch briefly on which assumption(s) of linear regression may be a concern, and additional thoughts you have about how well (or not well…) the linear model describes the relationship. What worries you?

## Summary

ADD ___ Include a very short summary describing your main findings from your juvenile hares exploration (bullet points are fine)

## Citations

Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14


ADD ___ any other resources that were references in your mini report.